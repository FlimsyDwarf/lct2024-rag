# Описание работы пайплайна RAG системы

Пайплайн если включен поиск информации в интернете:
<img width="1336" alt="CF-RAG" src="https://github.com/MisterAndry/lct2024-rag/assets/9989672/b064e550-48a4-4a62-beec-805e051332ad">



Пайплайн если поиск только по документам пользователя и по пользовательским ссылкам:
<img width="728" alt="CF-RAG_1" src="https://github.com/MisterAndry/lct2024-rag/assets/9989672/ab13f35e-0160-4a72-bc17-15f74c82ddee">

## Что используем
1. **LLM Framework**: LangChain
2. **LLM**: Chat GPT4o API
3. **Embedder**: OpenAI Embedding - text-embedding-3-large
4. **VectorStore**: Faiss
5. **Web-search**: Jina AI + Tavily search
6. **PDF parser**: PuMyPDF


### Основные этапы:

1. **Инициализация и заполнение векторного хранилища**:
  - Парсинг сайтов (**Jina AI**), полученных от пользователя, и парсинг документов пользователя (**PuMyPDF**).
  - Эмбеддинг полученных данных (**text-embedding-3-large**) и помещение их в векторное хранилище (**Faiss**)
2. **Разделение вопросов**:
  - Исходный запрос при помощи LLM делится на отдельные вопросы с учетом заданного диапазона дат (если пользователь указал временные рамки поиска информации для отчёта)
3. **Процессинг запросов**:
  - Для каждого вопроса выполняется поиск релевантных документов в векторном хранилище + поиск в инетрнете, если пользователь поставил галочку **Search in the internet** в UI
  - Все найденные документы фильтруются и ранжируются
  - На основе найденной информации генерерируется первоначальный ответ на вопрос
  - Проверка не галлюцинирует ли LLM (проверяет саму себя - насколько ответ обоснован и подкреплен набором фактом):
    * если не отвечает, то LLM переформулирует вопрос, и инициирует поиск информации в интернете с новым вопросом. Пункт 3 начинается сначала
    * если отвечает, то делает последнюю проверку - насколько ответ полезен для решения вопроса. Если не полезен, то LLM переформулирует вопрос, и инициирует поиск информации в интернете с новым вопросом. Пункт 3 начинается сначала.
    * если пункт 3 был выполнен три раза и ответ не был найдет, то используем последний сгенерированный ответ и переходим в п.4
4. **Вывод результатов**: Результаты собираются в словарь, где ключами являются вопросы, а значениями — ответы. Этот словарь отправялется в генератор отчёта.


Граф позволяет гибко и эффективно обрабатывать сложные запросы, используя промпт-инжиниринг и многоэтапный подход.
